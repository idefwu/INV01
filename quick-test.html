<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº«å­˜ç®¡ç†ç³»çµ± - å¿«é€Ÿæ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>åº«å­˜ç®¡ç†ç³»çµ± - å¿«é€Ÿæ¸¬è©¦</h1>
    
    <div class="container">
        <h2>ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h2>
        <button onclick="runQuickTest()">åŸ·è¡Œå¿«é€Ÿæ¸¬è©¦</button>
        <div id="results"></div>
    </div>

    <!-- Scripts -->
    <script src="basic/js/models.js"></script>
    <script src="basic/js/utils.js"></script>
    <script src="basic/js/dashboard.js"></script>
    <script src="basic/js/products.js"></script>
    <script src="basic/js/customers.js"></script>
    <script src="basic/js/suppliers.js"></script>
    <script src="basic/js/purchase.js"></script>
    <script src="basic/js/sales.js"></script>
    <script src="basic/js/inventory.js"></script>
    <script src="basic/js/reports.js"></script>
    
    <script>
        function runQuickTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<h3>åŸ·è¡Œæ¸¬è©¦ä¸­...</h3>';
            
            const testResults = [];
            
            try {
                // 1. æ¸¬è©¦ç³»çµ±åˆå§‹åŒ–
                const system = new InventorySystem();
                testResults.push({ name: 'ç³»çµ±åˆå§‹åŒ–', pass: !!system, details: 'æˆåŠŸå‰µå»º InventorySystem å¯¦ä¾‹' });
                
                // 2. æ¸¬è©¦å·¥å…·å‡½æ•¸
                const dateFormatted = Utils.formatDate('2024-12-25');
                testResults.push({ name: 'æ—¥æœŸæ ¼å¼åŒ–', pass: !!dateFormatted, details: dateFormatted });
                
                const currency = Utils.formatCurrency(12345);
                testResults.push({ name: 'è²¨å¹£æ ¼å¼åŒ–', pass: !!currency, details: currency });
                
                // 3. æ¸¬è©¦å•†å“ç®¡ç†
                const product = system.addProduct('TEST001', 'æ¸¬è©¦å•†å“', 'æ¸¬è©¦è¦æ ¼', 'å€‹', 100, 150, 10, 20);
                testResults.push({ name: 'æ–°å¢å•†å“', pass: !!product, details: `å•†å“ID: ${product ? product.id : 'å¤±æ•—'}` });
                
                // 4. æ¸¬è©¦å®¢æˆ¶ç®¡ç†
                const customer = system.addCustomer('æ¸¬è©¦å®¢æˆ¶', '0912345678', 'test@example.com', 'å°åŒ—å¸‚');
                testResults.push({ name: 'æ–°å¢å®¢æˆ¶', pass: !!customer, details: `å®¢æˆ¶ID: ${customer ? customer.id : 'å¤±æ•—'}` });
                
                // 5. æ¸¬è©¦ä¾›æ‡‰å•†ç®¡ç†
                const supplier = system.addSupplier('æ¸¬è©¦ä¾›æ‡‰å•†', 'ç‹å…ˆç”Ÿ', '02-12345678', 'supplier@test.com', 'æ–°åŒ—å¸‚', '12345678');
                testResults.push({ name: 'æ–°å¢ä¾›æ‡‰å•†', pass: !!supplier, details: `ä¾›æ‡‰å•†ID: ${supplier ? supplier.id : 'å¤±æ•—'}` });
                
                // 6. æ¸¬è©¦æ¨¡çµ„åˆå§‹åŒ–
                let modulesOK = true;
                let moduleDetails = '';
                
                try {
                    const dashboardModule = new DashboardModule(system);
                    const productsModule = new ProductsModule(system);
                    const customersModule = new CustomersModule(system);
                    const suppliersModule = new SuppliersModule(system);
                    const purchaseModule = new PurchaseModule(system);
                    const salesModule = new SalesModule(system);
                    const inventoryModule = new InventoryModule(system);
                    const reportsModule = new ReportsModule(system);
                    
                    moduleDetails = 'æ‰€æœ‰æ¨¡çµ„åˆå§‹åŒ–æˆåŠŸ';
                } catch (error) {
                    modulesOK = false;
                    moduleDetails = 'æ¨¡çµ„åˆå§‹åŒ–å¤±æ•—: ' + error.message;
                }
                
                testResults.push({ name: 'æ¨¡çµ„åˆå§‹åŒ–', pass: modulesOK, details: moduleDetails });
                
                // 7. æ¸¬è©¦é€²è²¨æµç¨‹
                if (product && supplier) {
                    const purchaseOrder = system.createPurchaseOrder(
                        supplier.id,
                        new Date().toISOString().split('T')[0],
                        [{ productId: product.id, quantity: 50, unitPrice: 90 }]
                    );
                    testResults.push({ name: 'å»ºç«‹é€²è²¨å–®', pass: !!purchaseOrder, details: `é€²è²¨å–®ID: ${purchaseOrder ? purchaseOrder.id : 'å¤±æ•—'}` });
                    
                    if (purchaseOrder) {
                        system.receivePurchaseOrder(purchaseOrder.id);
                        const updatedProduct = system.getProductById(product.id);
                        const stockIncreased = updatedProduct.currentStock === 70; // 20 + 50
                        testResults.push({ name: 'æ”¶è²¨æ›´æ–°åº«å­˜', pass: stockIncreased, details: `åº«å­˜: ${updatedProduct.currentStock}` });
                    }
                }
                
                // 8. æ¸¬è©¦éŠ·è²¨æµç¨‹
                if (product && customer) {
                    const salesOrder = system.createSalesOrder(
                        customer.id,
                        new Date().toISOString().split('T')[0],
                        [{ productId: product.id, quantity: 15, unitPrice: 150 }]
                    );
                    testResults.push({ name: 'å»ºç«‹éŠ·è²¨å–®', pass: !!salesOrder, details: `éŠ·è²¨å–®ID: ${salesOrder ? salesOrder.id : 'å¤±æ•—'}` });
                    
                    if (salesOrder) {
                        const updatedProduct = system.getProductById(product.id);
                        const stockDecreased = updatedProduct.currentStock === 55; // 70 - 15
                        testResults.push({ name: 'éŠ·è²¨æ‰£æ¸›åº«å­˜', pass: stockDecreased, details: `åº«å­˜: ${updatedProduct.currentStock}` });
                    }
                }
                
                // 9. æ¸¬è©¦åº«å­˜èª¿æ•´
                if (product) {
                    system.adjustInventory(product.id, 'increase', 10, 'æ¸¬è©¦èª¿æ•´');
                    const updatedProduct = system.getProductById(product.id);
                    const adjustmentOK = updatedProduct.currentStock === 65; // 55 + 10
                    testResults.push({ name: 'åº«å­˜èª¿æ•´', pass: adjustmentOK, details: `èª¿æ•´å¾Œåº«å­˜: ${updatedProduct.currentStock}` });
                }
                
                // 10. æ¸¬è©¦çµ±è¨ˆæ•¸æ“š
                const totalProducts = system.products.length;
                const totalCustomers = system.customers.length;
                const totalSuppliers = system.suppliers.length;
                const totalPurchaseOrders = system.purchaseOrders.length;
                const totalSalesOrders = system.salesOrders.length;
                
                testResults.push({ name: 'çµ±è¨ˆæ•¸æ“š', pass: true, details: `å•†å“: ${totalProducts}, å®¢æˆ¶: ${totalCustomers}, ä¾›æ‡‰å•†: ${totalSuppliers}, é€²è²¨å–®: ${totalPurchaseOrders}, éŠ·è²¨å–®: ${totalSalesOrders}` });
                
            } catch (error) {
                testResults.push({ name: 'ç³»çµ±æ¸¬è©¦ç•°å¸¸', pass: false, details: error.message });
                console.error('æ¸¬è©¦ç•°å¸¸:', error);
            }
            
            // é¡¯ç¤ºçµæœ
            let html = '<h3>æ¸¬è©¦çµæœ</h3>';
            let passCount = 0;
            let totalCount = testResults.length;
            
            testResults.forEach(result => {
                const className = result.pass ? 'pass' : 'fail';
                const status = result.pass ? 'âœ“ é€šé' : 'âœ— å¤±æ•—';
                if (result.pass) passCount++;
                
                html += `<div class="result ${className}">
                    <strong>${result.name}:</strong> ${status}<br>
                    <small>${result.details}</small>
                </div>`;
            });
            
            html += `<div class="result ${passCount === totalCount ? 'pass' : 'fail'}">
                <strong>ç¸½è¨ˆ:</strong> ${passCount}/${totalCount} é …æ¸¬è©¦é€šé (${((passCount/totalCount)*100).toFixed(1)}%)
            </div>`;
            
            results.innerHTML = html;
            
            // åœ¨æ§åˆ¶å°è¼¸å‡ºè©³ç´°ä¿¡æ¯
            console.log('å¿«é€Ÿæ¸¬è©¦å®Œæˆ:', {
                passed: passCount,
                total: totalCount,
                success: passCount === totalCount,
                results: testResults
            });
            
            // å¦‚æœæ‰€æœ‰æ¸¬è©¦é€šéï¼Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯
            if (passCount === totalCount) {
                alert('ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼åº«å­˜ç®¡ç†ç³»çµ±é‹ä½œæ­£å¸¸ã€‚');
            } else {
                alert('âš ï¸ éƒ¨åˆ†æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ§åˆ¶å°è¼¸å‡ºä»¥ç²å–æ›´å¤šè©³ç´°ä¿¡æ¯ã€‚');
            }
        }
        
        // é é¢åŠ è¼‰å®Œæˆå¾Œè‡ªå‹•åŸ·è¡Œæ¸¬è©¦
        window.addEventListener('load', () => {
            console.log('é é¢åŠ è¼‰å®Œæˆï¼Œæº–å‚™åŸ·è¡Œå¿«é€Ÿæ¸¬è©¦...');
            setTimeout(runQuickTest, 500);
        });
    </script>
</body>
</html>